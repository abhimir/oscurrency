<%- column_div :type => :primary do -%>
  <h2><%= t('people.edit.header') %></h2>

  <div id="profile_edit">

  <h3><%= t('people.edit.personal_details') %></h3>

    <%= error_messages_for :person %>
    
    <% form_for @person do |f| %>

      <div class="form_row">
        <label for="person_name"><%= t('people.edit.name') %></label>
        <%= f.text_field :name, :maxlength => Person::MAX_NAME %>
      </div>
      <div class="form_row">
          <label for="person_phoneprivacy"
            class="checkbox"><%= t('people.edit.share_phone_number') %></label>
          <%= f.check_box :phoneprivacy %>
      </div>
      <div class="form_row">
        <label for="person_phone"><%= image_tag "icons/phone.gif", :class => "icon", :alt => "Phone" %> <%= t('people.edit.phone') %></label>
        <%= f.text_field :phone %>
      </div>
    <% unless global_prefs.twitter_name.blank? %>
      <div class="form_row">
        <label for="twitter_name"><%= t('people.edit.twitter_id') %></label>
        <%= f.text_field :twitter_name, :maxlength => Person::MAX_TWITTER_NAME %>
      </div>
    <% end %>

  <div class="form_row full">
        <label for="person_categories"><%= t('people.edit.services_offered') %>
        </label>
        <%= render :partial => "shared/select_categories", :locals => { :model_name => 'person' } %>
  </div>
  
  <div class="form_row full">
        <label for="person_neighborhoods"><%= t('people.edit.neighborhood') %>
        </label>
        <%= render :partial => "shared/select_neighborhoods", :locals => { :model_name => 'person' } %>
  </div>

      <div class="form_row">
        <label for="person_description"><%= t('people.edit.description') %>
        </label>
    
        <%- unless @preview.nil? -%>
          <%= display @preview %>
        <%- end -%>
        
        <%= f.text_area :description %>
      </div>

      <%= render :partial => 'language', :locals => {:f => f} %>

      <div class="form_row">
        <label for="person_email"><%= t('people.edit.email') %></label>
        <%= f.text_field :email, :maxlength => Person::MAX_EMAIL %>
      </div>
      
      <%- if global_prefs.email_notifications? -%>
      
        <br />
      
        <h3><%= t('people.edit.email_notification_preferences') %></h3>
      
        <p>
          <%= t('people.edit.email_notification_note') %> 
        </p>
        
      
        <div class="form_row">
          <p>
          <label for="req_notifications"
                 class="checkbox"><%= t('people.edit.requests_in_my_service_categories') %></label>
          <%= f.check_box :connection_notifications %>
          </p>
          <p>
          <label for="message_notifications"
                 class="checkbox"><%= t('people.edit.messages') %></label>
          <%= f.check_box :message_notifications %>
          </p>
          <p>
          <label for="wall_comment_notifications"
                 class="checkbox"><%= t('people.edit.wall_comments') %></label>
          <%= f.check_box :wall_comment_notifications %>
          </p>
          <p>
          <label for="forum_notifications"
                 class="checkbox"><%= t('people.edit.forum_posts') %></label>
          <%= f.check_box :forum_notifications %>
          </p>
        </div>
      <%- end -%>
      
      <br />
  
      <div class="form_row">
        <%= f.submit t('button_update'), :class => "button" %>
        <%= f.submit "Preview", :id => "preview", :class => "button" %>
      </div>
      <input type="hidden" name="type" value="info_edit" />
  <% end %>

  <br />

  <h3><%= t('people.edit.photos') %></h3>
  
    <% if @person.photos.empty? %>
      <%= image_tag @person.thumbnail %>
    <% else %>
    <table>
      <% @person.sorted_photos.collect_every(N_COLUMNS) do |row| %>
      <tr>
      <% row.each do |photo| %>
        <td  style="padding-left: 1em;">
          <%= image_tag photo.public_filename(:thumbnail) %>
        </td>
      <% end %>
      </tr>
      <tr>
        <% row.each do |photo| %>
        <td style="padding-left: 1em;">
          <% if photo.primary? %>
            primary
          <% else %>
            <%= link_to t('button_select'), photo_path(photo),
                                          :method => :put %>
          <% end %>
          |
          <%= link_to image_tag("icons/close.gif"), photo_path(photo),
                                               :method => :delete %>
        </td>
        <% end %>
      </tr>
      <% end %>
    </table>
    <% end %>
    <br />
    <%= button_to t('people.edit.add_a_photo'), new_photo_path, :class => "button" %>
  </div>

  <br />
  <h3><%= t('people.edit.addresses') %></h3>
  <%= render :partial => 'address', :collection => @person.addresses %>
  <div class="status-btn" style="float: left">
    <input type="button" name="update" value="<%= t('people.edit.add_address') %>" id="update-submit" onclick="document.location='<%= new_person_address_path(@person) %>';" />
  </div>
  <br />
<%- end -%>

<%- column_div :type => :secondary do -%>
  <h2><%= t('people.edit.login_settings') %></h2>
  <h3><%= t('people.edit.change_your_password') %></h3>
  <% form_for @person, :html => { :id => "change_password" } do |f| %>

    <div class="form_row">
      <label for="password"><%= t('people.edit.current_password') %></label>
      <%= f.password_field :verify_password,
                           :size => 34,
                           :maxlength => Person::MAX_PASSWORD %>
    </div>

    <div class="form_row">
      <label for="password"><%= t('people.edit.new_password') %></label>
      <%= f.password_field :new_password,
                           :size => 34,
                           :maxlength => Person::MAX_PASSWORD %>
    </div>

    <div class="form_row">
      <label for="password_confirmation"><%= t('people.edit.confirm_password') %></label>
      <%= f.password_field :password_confirmation,
                           :size => 34,
                           :maxlength => Person::MAX_PASSWORD,
                           :value => "" %>
    </div>
    <div class="form_row">
      <%= submit_tag t('people.edit.change_password'), :class => "button" %>
    </div>
    <input type="hidden" name="type" value="password_edit" />
  <% end %>
  <h3>Facebook Connect</h3>
  <div>
    <div style="float:left;"><%= image_tag "fbicon.png", :class => "icon", :alt => "facebook connect" %></div><div class="small" style="float:left;"><%= link_to "Link Facebook account", facebook_connect_edit_person_path(current_person) %></div>
  </div>
<%- end -%>

<%= yui_headers('person_description') %>
